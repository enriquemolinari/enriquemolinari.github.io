<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 5.0.0 | Copyright Dean Attali 2020 -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Lambda Expressions in Java, a Concrete Example</title>

  
  <meta name="author" content="Enrique Molinari">
  

  <meta name="description" content="Maybe you have read several posts on the web on how Lambda Expressions are used. Most of the ones I have read uses examples for filtering collections with the new Stream API of Java 8. Those examples are good but they are more focused on showing a fancy way of...">

  

  

  
  <link rel="alternate" type="application/rss+xml" title="Copy & Paste is for Word" href="/feed.xml">
  

  

  

  
<!-- Google Analytics -->
<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date(); a = s.createElement(o),
      m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'UA-23512716-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Copy & Paste is for Word">
  <meta property="og:title" content="Lambda Expressions in Java, a Concrete Example">
  <meta property="og:description" content="Maybe you have read several posts on the web on how Lambda Expressions are used. Most of the ones I have read uses examples for filtering collections with the new Stream API of Java 8. Those examples are good but they are more focused on showing a fancy way of...">

  
  <meta property="og:image" content="/assets/img/mi-foto.jpeg">
  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Enrique Molinari">
  <meta property="og:article:published_time" content="2015-11-15T08:00:00-05:00">
  <meta property="og:url" content="/2015-11-15-lambda/">
  <link rel="canonical" href="/2015-11-15-lambda/">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@">
  <meta name="twitter:creator" content="@">

  <meta property="twitter:title" content="Lambda Expressions in Java, a Concrete Example">
  <meta property="twitter:description" content="Maybe you have read several posts on the web on how Lambda Expressions are used. Most of the ones I have read uses examples for filtering collections with the new Stream API of Java 8. Those examples are good but they are more focused on showing a fancy way of...">

  
  <meta name="twitter:image" content="/assets/img/mi-foto.jpeg">
  

  


  

  

</head>


<body>

  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="">Copy & Paste is for Word</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/aboutme">About Me</a>
          </li>
        <li class="nav-item">
          <a class="nav-link" id="nav-search-link" href="#" title="Search">
            <span id="nav-search-icon" class="fa fa-search"></span>
            <span id="nav-search-text">Search</span>
          </a>
        </li></ul>
  </div>

  

  
    <div class="avatar-container">
      <div class="avatar-img-border">
        <a href="">
          <img alt="Navigation bar avatar" class="avatar-img" src="/assets/img/mi-foto.jpeg" />
        </a>
      </div>
    </div>
  

</nav>



<div id="beautifuljekyll-search-overlay">

  <div id="nav-search-exit" title="Exit search">✕</div>
  <input type="text" id="nav-search-input" placeholder="Search">
  <ul id="search-results-container"></ul>
  
  <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
  <script>
    var searchjson = '[ \
       \
        { \
          "title"    : "Implementing Progressive Web Apps with React", \
          "category" : "ReactProgressive Web Apps", \
          "url"      : "/2022-06-20-pwa-react/", \
          "date"     : "June 20, 2022" \
        }, \
       \
        { \
          "title"    : "Understanding React", \
          "category" : "ReactSPA", \
          "url"      : "/2021-12-25-understanding-react/", \
          "date"     : "December 25, 2021" \
        }, \
       \
        { \
          "title"    : "Coding an Architecture Style", \
          "category" : "Software ArchitectureDesign", \
          "url"      : "/2020-06-12-coding-architecture/", \
          "date"     : "June 12, 2020" \
        }, \
       \
        { \
          "title"    : "Object Oriented Frameworks: Concepts, White Box and Black Box Examples", \
          "category" : "Object OrientedFramework", \
          "url"      : "/2016-06-11-frameworks/", \
          "date"     : "June 11, 2016" \
        }, \
       \
        { \
          "title"    : "Lambda Expressions in Java, a Concrete Example", \
          "category" : "Object OrientedLambda Expressions", \
          "url"      : "/2015-11-15-lambda/", \
          "date"     : "November 15, 2015" \
        }, \
       \
        { \
          "title"    : "Use Inheritance Properly", \
          "category" : "Object OrientedInheritance", \
          "url"      : "/2013-08-08-inheritance/", \
          "date"     : "August  8, 2013" \
        }, \
       \
        { \
          "title"    : "Please, use the debugguer", \
          "category" : "debug", \
          "url"      : "/2012-12-24-use-debugger/", \
          "date"     : "December 24, 2012" \
        }, \
       \
        { \
          "title"    : "Software Architecture vs Software Design", \
          "category" : "", \
          "url"      : "/2011-07-13-arch-vs-design/", \
          "date"     : "July 13, 2011" \
        }, \
       \
        { \
          "title"    : "A Note on the Definition of Legacy Code", \
          "category" : "", \
          "url"      : "/2011-06-20-legacy-code/", \
          "date"     : "June 20, 2011" \
        }, \
       \
        { \
          "title"    : "What is the role of a Software Architect ?", \
          "category" : "", \
          "url"      : "/2011-05-22-architect-role/", \
          "date"     : "May 22, 2011" \
        }, \
       \
       \
        { \
          "title"    : "What is this About?", \
          "category" : "page", \
          "url"      : "/about/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "What is this About?", \
          "category" : "page", \
          "url"      : "/aboutme/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "My website", \
          "category" : "page", \
          "url"      : "/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Tag Index", \
          "category" : "page", \
          "url"      : "/tags/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "My website", \
          "category" : "page", \
          "url"      : "/page2/", \
          "date"     : "January 1, 1970" \
        } \
       \
    ]';
    searchjson = JSON.parse(searchjson);

    var sjs = SimpleJekyllSearch({
      searchInput: document.getElementById('nav-search-input'),
      resultsContainer: document.getElementById('search-results-container'),
      json: searchjson
    });
  </script>
</div>





  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>Lambda Expressions in Java, a Concrete Example</h1>
          

          
            <span class="post-meta">Posted on November 15, 2015</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <p>Maybe you have read several posts on the web on how Lambda Expressions are used. Most of the ones I have read uses examples for filtering collections with the new Stream API of Java 8. Those examples are good but they are more focused on showing a <em>fancy</em> way of filtering a collection rather than on showing or highlight the code structures that now you don’t have to write, in this case, the <em>for loops</em>. Without Lambda Expressions, each time you need to filter data from a collection, you have to iterate the collection (repeating a for loop construction). That is not necessary any more.</p>

<p>In this post I will show a concrete example of removing duplicated code using <strong>Lambda Expressions</strong>. For the demonstration I will be using JPA (Java Persistence API), following the topics of my previous post.</p>

<p>I believe that showing how to use Lambda Expressions putting the focus on the <strong>removal of duplicated code</strong> will open your mind on the potential that they have.</p>

<p>Suppose I’m asked to write some code to do a simple <em>save</em>, <em>update</em> and <em>retrieve</em> of a specific Entity class, using <strong>JPA</strong>. To implement that, I will write a class called <em>ADataAccessObject</em> (just to name it somehow). Below you will find what I have written in my first development iteration, the <strong>make it work</strong> step.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ADataAccessObject</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">EntityManagerFactory</span> <span class="n">emf</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">ADataAccessObject</span><span class="o">(</span><span class="nc">EntityManagerFactory</span> <span class="n">emf</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">emf</span> <span class="o">=</span> <span class="n">emf</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="nc">AnEntity</span> <span class="n">anEntity</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
		<span class="nc">EntityTransaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">tx</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
			<span class="n">tx</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

			<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">anEntity</span><span class="o">);</span>

			<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">tx</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
			<span class="o">}</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
			<span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">aNewPropertyValue</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
		<span class="nc">EntityTransaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">tx</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
			<span class="n">tx</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

			<span class="nc">AnEntity</span> <span class="n">anEntity</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">AnEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
			<span class="n">anEntity</span><span class="o">.</span><span class="na">setAProperty</span><span class="o">(</span><span class="n">aNewPropertyValue</span><span class="o">);</span>

			<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">tx</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
			<span class="o">}</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
			<span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">AnEntity</span> <span class="nf">byId</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">AnEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
			<span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now lets write the client code that use the class above:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">arg</span><span class="o">[])</span> <span class="o">{</span>
		<span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">emf</span> <span class="o">=</span> <span class="nc">Persistence</span>
					<span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">(</span><span class="s">"a-persistence-name"</span><span class="o">);</span>
			<span class="nc">ADataAccessObject</span> <span class="n">dao</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ADataAccessObject</span><span class="o">(</span><span class="n">emf</span><span class="o">);</span>
			<span class="c1">//store anEntity ...</span>
			<span class="n">dao</span><span class="o">.</span><span class="na">store</span><span class="o">(</span><span class="k">new</span> <span class="nc">AnEntity</span><span class="o">(</span><span class="s">"aValuForTheProperty"</span><span class="o">));</span>
			<span class="c1">//update anEntity ...</span>
			<span class="n">dao</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="mi">1</span><span class="n">l</span><span class="o">,</span> <span class="s">"anotherValueForTheProperty"</span><span class="o">);</span>
			<span class="c1">//retrieving ...</span>
			<span class="nc">AnEntity</span> <span class="n">e</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">byId</span><span class="o">(</span><span class="mi">1</span><span class="n">l</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
			<span class="n">emf</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>What does not look nice from the code above</strong>? As you might have noticed, each method seems to be pretty similar. The <strong>try</strong>/<strong>catch</strong>/<strong>finally</strong> block with the creation of the <em>EntityManager</em>, the <em>Transaction#commit</em>, <em>Transaction#rollback</em> and the <em>EntityManager#close</em>, all of these are duplicated.</p>

<p>To clarify a bit more, below are the sentences unique per method:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//from ADataAccessObject#store</span>
<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">anEntity</span><span class="o">);</span>

<span class="c1">//from ADataAccessObject#update</span>
<span class="nc">AnEntity</span> <span class="n">anEntity</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">AnEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
<span class="n">anEntity</span><span class="o">.</span><span class="na">setAProperty</span><span class="o">(</span><span class="n">aNewPropertyValue</span><span class="o">);</span>

<span class="c1">//from ADataAccessObject#byId</span>
<span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">AnEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
</code></pre></div></div>

<p><strong>How can we remove that duplicated code</strong>? There are some options. You can use Dynamic Proxys or AspectJ. Or incorporate a framework like Spring to handle JPA Transactions for you. Do we have simpler approach? I don’t want to incorporate any framework, I would love the language itself provides the syntactical construction to do it.</p>

<p>What if the programming language allows you to pass a <strong>block of code</strong> as a method parameter? That sounds great, because I can create a private method in my <em>ADataAccessObject</em> class with the <strong>try</strong>/<strong>catch</strong>/<strong>finally</strong> structure and receive each unique block of sentences by parameter.</p>

<p>Before Java 8, this was possible using <strong>Anonymous Classes</strong>. Lets moving ahead with this approach then.</p>

<p>For implementing this approach we have to create an <strong>Interface</strong> to specify the signature of the <strong>block of code</strong> that we need to pass by parameter. Described next:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ABlockOfCode</span> <span class="o">{</span>
	<span class="nc">AnEntity</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">EntityManager</span> <span class="n">em</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>That <strong>Inteface</strong> above is the type of my block of code. Each block of code will respond to the <em>execute</em> method, it must receive the <strong>EntityManager</strong> by parameter and must return <em>AnEntity</em>.
Lets go through the second iteration of my code, the <strong>make it better</strong> step. I will refactor a bit my <em>ADataAccessObject</em> Class adding some anonymous classes to eliminate duplicated code.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ADataAccessObject</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">EntityManagerFactory</span> <span class="n">emf</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">ADataAccessObject</span><span class="o">(</span><span class="nc">EntityManagerFactory</span> <span class="n">emf</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">emf</span> <span class="o">=</span> <span class="n">emf</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">store</span><span class="o">(</span><span class="nc">AnEntity</span> <span class="n">anEntity</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">transactionExecute</span><span class="o">(</span><span class="k">new</span> <span class="nc">ABlockOfCode</span><span class="o">()</span> <span class="o">{</span>
			<span class="nd">@Override</span>
			<span class="kd">public</span> <span class="nc">AnEntity</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">EntityManager</span> <span class="n">em</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">anEntity</span><span class="o">);</span>
				<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
			<span class="o">}</span>
		<span class="o">});</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">aNewPropertyValue</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">transactionExecute</span><span class="o">(</span><span class="k">new</span> <span class="nc">ABlockOfCode</span><span class="o">()</span> <span class="o">{</span>
			<span class="nd">@Override</span>
			<span class="kd">public</span> <span class="nc">AnEntity</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">EntityManager</span> <span class="n">em</span><span class="o">)</span> <span class="o">{</span>
				<span class="nc">AnEntity</span> <span class="n">anEntity</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">AnEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
				<span class="n">anEntity</span><span class="o">.</span><span class="na">setAProperty</span><span class="o">(</span><span class="n">aNewPropertyValue</span><span class="o">);</span>
				<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
			<span class="o">}</span>
		<span class="o">});</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">AnEntity</span> <span class="nf">byId</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nf">transactionExecute</span><span class="o">(</span><span class="k">new</span> <span class="nc">ABlockOfCode</span><span class="o">()</span> <span class="o">{</span>
			<span class="nd">@Override</span>
			<span class="kd">public</span> <span class="nc">AnEntity</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">EntityManager</span> <span class="n">em</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">AnEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>			<span class="o">}</span>
		<span class="o">});</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="nc">AnEntity</span> <span class="nf">transactionExecute</span><span class="o">(</span><span class="nc">ABlockOfCode</span> <span class="n">aBlockOfCode</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
		<span class="nc">EntityTransaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">tx</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
			<span class="n">tx</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

			<span class="nc">AnEntity</span> <span class="n">a</span> <span class="o">=</span> <span class="n">aBlockOfCode</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">em</span><span class="o">);</span>

			<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
			<span class="k">return</span> <span class="n">a</span><span class="o">;</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">tx</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
			<span class="o">}</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
			<span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>As you can see, I have created a private method called <em>transactionExecute</em> which expects as parameter an instance of <em>ABlockOfCode</em>. In each <em>public</em> method, I’m creating these instances, as anonymous classes, implementing the <em>execute</em> method of the <em>ABlockOfCode</em> with the sentences unique per method described before. Then, each method calls <em>transactionExecute</em>, passing these <em>ABlockOfCode</em> instances by parameter. Finally, note that inside the <em>transactionExecute</em> method, there is a call to the <em>execute</em> method of the <em>ABlockOfCode</em> instance, inside the <strong>try</strong>/<strong>catch</strong>/<strong>finally</strong> template.</p>

<p><strong>Not bad right</strong>? Let’s do it now even better in my third development iteration. I’m going to replace the anonymous classes with <strong>Lambdas</strong>. In Java 8, Lambdas are a prettier way of writing anonymous classes (not the case for functional programming languages, but this is a different talk). They incorporate a syntactic sugar plus a type inference system, which make the code cleaner and easier to read. The code below starts moving the <em>transactionExecute</em> private method to its own class.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransactionTemplate</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="nc">EntityManagerFactory</span> <span class="n">emf</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">TransactionTemplate</span><span class="o">(</span><span class="nc">EntityManagerFactory</span> <span class="n">emf</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">emf</span> <span class="o">=</span> <span class="n">emf</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">AnEntity</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">ABlockOfCode</span> <span class="n">aBlockOfCode</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
		<span class="nc">EntityTransaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">tx</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
			<span class="n">tx</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

			<span class="nc">AnEntity</span> <span class="n">returnValue</span> <span class="o">=</span> <span class="n">aBlockOfCode</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">em</span><span class="o">);</span>

			<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
			<span class="k">return</span> <span class="n">returnValue</span><span class="o">;</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">tx</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
			<span class="o">}</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
			<span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ADataAccessObject</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">TransactionTemplate</span> <span class="n">transaction</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">ADataAccessObject</span><span class="o">(</span><span class="nc">TransactionTemplate</span> <span class="n">transaction</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">transaction</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">store</span><span class="o">(</span><span class="nc">AnEntity</span> <span class="n">anEntity</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">transaction</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span>
			<span class="o">(</span><span class="n">em</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">anEntity</span><span class="o">);</span>
				<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
			<span class="o">});</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">aNewPropertyValue</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">transaction</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span>
			<span class="o">(</span><span class="n">em</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="nc">AnEntity</span> <span class="n">anEntity</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">AnEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
				<span class="n">anEntity</span><span class="o">.</span><span class="na">setAProperty</span><span class="o">(</span><span class="n">aNewPropertyValue</span><span class="o">);</span>
				<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
			<span class="o">});</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">AnEntity</span> <span class="nf">byId</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">transaction</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span>
			<span class="o">(</span><span class="n">em</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
				<span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">AnEntity</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
			<span class="o">});</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>On the highlighted lines you will see the Lambda Expressions. A lambda expression, is composed of two parts, separated by the lexical token “-&gt;”: (parameters) -&gt; { block of code }. There is no need to specify the type of the parameter in the lambda expression, it will be <strong>inferred</strong> from an <strong>interface</strong>, in this case, the <strong>ABlockOfCode</strong>. If you look at this interface you will note that each lambda expression receives an instance of the <em>EntityManager</em> as parameter, (em), and must return an instance of <em>AnEntity</em>.</p>

<p>As a final development iteration, I will make this more generic. My <em>ABlockOfCode</em> interface and <em>TransactionTemplate</em> class should support any object type, not only <em>AnEntity</em>. So next I will change the <em>AnEntity</em> type for a <strong>generic type</strong> <strong>T</strong>.
Starting with the <em>ABlockOfCode</em> interface:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ABlockOfCode</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="no">T</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">EntityManager</span> <span class="n">em</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>I have just replaced <em>AnEntity</em> with the generic type <strong>T</strong>, and I have declared that type <strong>T</strong> as a generic type, using the <strong>&lt;</strong>T<strong>&gt;</strong> syntax (on line 1).
Next, I will make the <em>TransactionTemplate#execute</em> method generic:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">ABlockOfCode</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">aBlockOfCode</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
	<span class="nc">EntityTransaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="k">try</span> <span class="o">{</span>
		<span class="n">tx</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
		<span class="n">tx</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>

		<span class="no">T</span> <span class="n">returnValue</span> <span class="o">=</span> <span class="n">aBlockOfCode</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">em</span><span class="o">);</span>

		<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
		<span class="k">return</span> <span class="n">returnValue</span><span class="o">;</span>
	<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">tx</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
	<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
		<span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>On line 1, I’m declaring the generic type &lt;<strong>T</strong>&gt;, changing the signature of the method returning <strong>T</strong> and expecting <em>ABlockOfCode</em>&lt;<strong>T</strong>&gt; as parameter. Note also that the return type of the <em>aBlockOfCode.execute(em)</em> sentence, has change from <em>AnEntity</em> to <strong>T</strong>, on line 8.</p>

<p>With this last change we have made the <em>TransactionTemplate#execute</em> method generic to be used by any instance of <em>ABlockOfCode</em> that requires a JPA transaction context. The <em>ADataAccessObject</em> class does not need to change, because as I explained before, the Lambdas <strong>infer</strong> their type from the <em>ABlockOfCode</em> interface.</p>

<p>We just went through out some development iterations in order to remove duplicated code. This nature of the duplicated code shown here, is not able to be removed using simple refactoring techniques like extract method or extract class. It requires more powerful language feature to allow passing sentences, or blocks of code, by parameter. That was achieved using anonymous classes first and then with Lambda Expressions. And remember, don’t do refactoring iterations without test coverage.</p>

      </article>

      
        <div class="blog-tags">
          <span>Tags:</span>
          
            <a href="/tags#Object Oriented">Object Oriented</a>
          
            <a href="/tags#Lambda Expressions">Lambda Expressions</a>
          
        </div>
      

      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
    <a href="https://twitter.com/intent/tweet?text=Lambda+Expressions+in+Java%2C+a+Concrete+Example&url=%2F2015-11-15-lambda%2F"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fab fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
    <a href="https://www.facebook.com/sharer/sharer.php?u=%2F2015-11-15-lambda%2F"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fab fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=%2F2015-11-15-lambda%2F"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fab fa-fw fa-linkedin" aria-hidden="true"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  

  

  

</section>



      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/2013-08-08-inheritance/" data-toggle="tooltip" data-placement="top" title="Use Inheritance Properly">&larr; Previous Post</a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/2016-06-11-frameworks/" data-toggle="tooltip" data-placement="top" title="Object Oriented Frameworks: Concepts, White Box and Black Box Examples">Next Post &rarr;</a>
        </li>
        
      </ul>
      
  
  
  

  


  



    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="mailto:enrique.molinari@gmail.com" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/enriquemolinari" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://linkedin.com/in/enrique-molinari-254a3764" title="LinkedIn">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">LinkedIn</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://stackoverflow.com/users/842533/enrique-molinari" title="StackOverflow">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">StackOverflow</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        Enrique Molinari
        &nbsp;&bull;&nbsp;
      
      2022

      
        &nbsp;&bull;&nbsp;
        <span class="author-site">
          <a href="">copypasteisforword.com</a>
        </span>
      

      
      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
